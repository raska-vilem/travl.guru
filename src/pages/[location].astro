---
import { readItems } from '@directus/sdk';
import BackButton from '@/atoms/back-button.astro';
import FormattedContent from '@/atoms/formatted-content.astro';
import ThemeToggle from '@/atoms/theme-toggle.astro';
import type { Location } from '@/generated/directus';
import DefaultLayout from '@/layouts/default.astro';
import { directusRequest } from '@/lib/directus';
import HowToGuides from '@/templates/how-to-guides.astro';

export async function getStaticPaths() {
    const locations = await directusRequest(readItems('location'));
    return locations.map((location) => ({
        params: { location: location.slug },
        props: { location },
    }));
}

interface Props {
    location: Location;
}

const { location } = Astro.props;

const howToGuides = await directusRequest(
    readItems('how_to', {
        filter: {
            location: location.id,
        },
    }),
);
---

<DefaultLayout title={ location.name } description={ location.description } og_image={ location.location_image }>
    <ThemeToggle class="absolute top-3 right-3 z-10" />
    <BackButton class="absolute top-3 left-3 z-10"/>

    <FormattedContent content={ location.description } class="mt-16"/>

    <HowToGuides howToGuides={howToGuides}/>
</DefaultLayout>
